<html>
<head>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.0/angular.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/1.1.1/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/0.8.0/angularfire.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <!-- load Bootstrap and custom style.css -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootswatch/3.3.0/journal/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- CHAT MARKUP -->
<div class="container">
    <div class="page-header text-center">
        <h1>System Setup</h1>
    </div>

    <div>
        <p>Enter the Event Title: </p><input type='text' id='titleInput' >
        <button type="button" onclick="doSave()" class="btn btn-primary saveButton">Save</button>
    </div>
    <div>Current event title:</div><div id="test"></div>
    <div> </div>
    <div class="warning"> CHANGING THESE SETTINGS WILL ERASE ALL APPOINTMENTS!!!   ARE YOU REALLY SURE!!!!</div>
</div>

<!-- CHAT JAVACRIPT -->
<script>
    // CREATE A REFERENCE TO FIREBASE
    var messagesRef = new Firebase('https://boiling-torch-6521.firebaseio.com/settings');
    var appointmentRef = new Firebase('https://boiling-torch-6521.firebaseio.com/appointments');
    var agentsRef = new Firebase('https://boiling-torch-6521.firebaseio.com/agents');
    var operatorsRef = new Firebase('https://boiling-torch-6521.firebaseio.com/operators');

    // REGISTER DOM ELEMENTS
    var messageField = $('#titleInput');
    var testField = $('#test');
    var startTime = "1300"; //event start time in 24hr format with no seperators
    var interval = "10"; // interval in minutes between each appointment
    var duration = "120"; //duration of the event in minutes
    var day = "Sunday"; // The day of the event 'name'

    // LISTEN FOR BUTTONPRESS EVENT  -   ALSO SAVE A SERIES OF 'settings' as well as the event title
    function doSave(){
            //FIELD VALUES
            var eventTitle = messageField.val();


            //SAVE DATA TO FIREBASE AND EMPTY FIELD
            messagesRef.set({eventTitle:eventTitle, startTime:startTime, interval:interval, duration:duration});
            messageField.val('');
            createAppointments();
            createAgents();
            createOperators();
        }

    // Attach an asynchronous callback to read the data at our posts reference
    messagesRef.on("value", function(snapshot) {
        var settings = snapshot.val();
        var eventTitle = settings.eventTitle;
        testField.text(settings.eventTitle);
        });

    function createAppointments(){

        var numAppointments =  (duration / interval);
        var slotsRef = appointmentRef.child("slots");
        for (i = 0; i < numAppointments; i++) {
            var appRef = slotsRef.child(i);
            var time = +startTime + +(i*interval)
            appRef.set({
                    time: time,booked: "false"
            });
        }
    }

    function createApps(){

        var numAppointments =  (duration / interval);
        var slotsRef = agentsRef.child("slots");
        for (i = 0; i < numAppointments; i++) {
            var appRef = slotsRef.child(i);
            var time = +startTime + +(i*interval)
            appRef.set({
                time: time,booked: "false"
            });
        }
    }


    function createAgents(){
        var numAppointments =  (duration / interval);
        var numAgents =  10;
        for (i = 0; i < numAgents; i++) {
            var slotsRef = agentsRef.child("Agent"+i)
            for (j = 0; j < numAppointments; j++) {
                var time = +startTime + +(j*interval)
                var appRef = slotsRef.child(time);
                appRef.set({
                    time: time,booked: "false"
                });
            }
        }
    }

    function createOperators(){
        var numAppointments =  (duration / interval);
        var numOperators =  10;
        for (i = 0; i < numOperators; i++) {
            var slotsRef = operatorsRef.child("Operator"+i)
            for (j = 0; j < numAppointments; j++) {
                var time = +startTime + +(j*interval)
                var appRef = slotsRef.child(time);
                appRef.set({
                    time: time,booked: "false"
                });
            }
        }
    }

</script>
</body>
</html>