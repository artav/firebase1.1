<html>
<head>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.0/angular.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/1.1.1/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/0.8.0/angularfire.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <!-- load Bootstrap and custom style.css -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootswatch/3.3.0/journal/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- CHAT MARKUP -->
<div class="container">
    <div class="page-header text-center">
        <h1>Add an operator</h1>
    </div>

    <div>
        <p>Enter your full name: </p><input type='text' id='nameInput' >
        <button type="button" onclick="doSave()" class="btn btn-primary saveButton">Save</button>
    </div>
</div>

<!-- CHAT JAVACRIPT -->
<script>
    // CREATE A REFERENCE TO FIREBASE
    var baseRef = new Firebase('https://boiling-torch-6521.firebaseio.com/');
    var settingsRef = new Firebase('https://boiling-torch-6521.firebaseio.com/settings');
 //   var settingsRef = baseRef.child('settings');
    var operatorsRef = baseRef.child('operators');

    // REGISTER DOM ELEMENTS
    var nameField = $('#nameInput');
    var startHour = "13"; //event start time in 24hr format with no seperators
    var startMin = "00"; //event start time in 24hr format with no seperators
    var interval = "10"; // interval in minutes between each appointment
    var duration = "120"; //duration of the event in minutes
    var day = "Sunday"; // The day of the event 'name'
    var date = new Date(); // new JS date object


 //       settings = snapshot.val();
 //       interval = settings.interval;



    settingsRef.once('value', function(snapshot) {
        console.log(snapshot.val());
        settings = snapshot.val();
        interval = settings.interval;
        duration = settings.duration;
        startHour = settings.startHour;
        startMin = settings.startMin;
        console.log(interval);
    });



    // LISTEN FOR BUTTONPRESS EVENT  -   ALSO SAVE A SERIES OF 'settings' as well as the event title
    function doSave(){
        //FIELD VALUES
        var name = nameField.val();


        //SAVE DATA TO FIREBASE AND EMPTY FIELD
      //  messagesRef.set({eventTitle:eventTitle, startTime:startTime, interval:interval, duration:duration});
      //  messageField.val('');
        createOperator(name);
    }


    ///******************************************* The hours and mins calcs are all wrong! ************

    function createOperator(name){
        var numAppointments =  (duration / interval);
        var numAgents =  10;
        for (i = 0; i < numAgents; i++) {
            var slotsRef = operatorsRef.child(name)
                slotsRef.set({name: name});
            for (j = 0; j < numAppointments; j++) {
                var totalMins = +(startHour * 60) + +startMin;  // '+' before a variable means treat it like a number
                var currentTotal = +totalMins + +(j*interval);
                var currentHours = Math.floor( currentTotal / 60);
                var currentMins = currentTotal % 60;
                if (currentMins == 0) currentMins = "00";  // if minutes = 0 then display it as 00
                var time = currentHours+":"+currentMins;
                var plainTime = "" + currentHours + currentMins;  // save time as a string with no ':'
                var plainNumTime = +plainTime; // makes the time a proper number for the key
                var appRef = slotsRef.child("slots/"+plainNumTime);
                appRef.set({
                    time: time,booked: false
                });
            }
        }
    }



</script>
</body>
</html>